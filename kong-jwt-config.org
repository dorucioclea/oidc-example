* Kong JWT Configuration

** jwt-secure api configuration

#+NAME: jwt-secure-api
#+BEGIN_SRC restclient
POST http://localhost:8001/apis
Content-Type: application/json

{
    "name":"jwt-secure",
    "upstream_url":"http://oidc-example-api:9000/",
    "strip_uri":"true",
    "uris":"/jwt-secure"
}
#+END_SRC
** Test HTTP from babel

#+NAME: httpie-test
#+BEGIN_SRC shell
  http POST http://localhost:8001/apis name=jwt-secure \
                upstream_url=http://oidc-example-api:9000/ \
                strip_uri=true \
                uris=/jwt-secure
#+END_SRC

#+RESULTS: httpie-test
** Test API is created with curl
#+NAME: jwt-secure-api
#+BEGIN_SRC shell :results code :wrap SRC js
curl http://localhost:8001/apis/jwt-secure
#+END_SRC

#+RESULTS: jwt-secure-api
#+BEGIN_SRC js
{"created_at":1517828195265,"strip_uri":true,"id":"8decca67-6373-43d8-b28d-4d749298148b","name":"jwt-secure","http_if_terminated":false,"https_only":false,"retries":5,"uris":["\/jwt-secure"],"upstream_url":"http:\/\/oidc-example-api:9000\/","upstream_send_timeout":60000,"upstream_read_timeout":60000,"upstream_connect_timeout":60000,"preserve_host":false}
#+END_SRC
** CORS plugin
#+NAME: jwt-secure-add-cors-plugin
#+BEGIN_SRC restclient
POST http://localhost:8001/apis/jwt-secure/plugins
Content-Type: application/json

{
    "name":"cors",
    "config.origins":"http://localhost:4040",
    "config.credentials":"true"
}

#+END_SRC

#+RESULTS: jwt-secure-add-cors-plugin
#+BEGIN_SRC js
{
  "api_id": "8decca67-6373-43d8-b28d-4d749298148b",
  "name": "cors",
  "enabled": true,
  "id": "0f9b7bf3-e30c-4ac3-8a59-a12c12abafe8",
  "config": {
    "preflight_continue": false,
    "origins": [
      "http://localhost:4040"
    ],
    "credentials": true
  },
  "created_at": 1517840513048
}
// POST http://localhost:8001/apis/jwt-secure/plugins
// HTTP/1.1 201 Created
// Date: Mon, 05 Feb 2018 14:21:53 GMT
// Content-Type: application/json; charset=utf-8
// Transfer-Encoding: chunked
// Connection: keep-alive
// Access-Control-Allow-Origin: *
// Server: kong/0.11.1
// Request duration: 0.047934s
#+END_SRC
** JWT Config
